import{r,j as e}from"./react-vendor-CqJDUI5z.js";import{q,c as w,o as R,g as T,u as H,d as y,T as S,b as B,r as M,e as O,f as _,h as $}from"./firebase-vendor-DImIJKtj.js";import{d,s as W}from"./firebase-DBkN4RL2.js";const z="metro2024";function Q(){const[h,m]=r.useState(!1),[p,C]=r.useState(""),[f,D]=r.useState([]),[u,x]=r.useState(!0),[o,v]=r.useState(null),[E,g]=r.useState(!1),[A,b]=r.useState(!1),[s,a]=r.useState({title:{he:"",en:""},excerpt:{he:"",en:""},content:{he:"",en:""},image:""});r.useEffect(()=>{h&&j()},[h]);const j=async()=>{try{const t=q(w(d,"posts"),R("createdAt","desc")),i=(await T(t)).docs.map(l=>({id:l.id,...l.data()}));D(i)}catch(t){console.error("Error fetching posts:",t)}finally{x(!1)}},L=t=>{t.preventDefault(),p===z?(m(!0),localStorage.setItem("adminAuth","true")):alert("Incorrect password")},I=()=>{m(!1),localStorage.removeItem("adminAuth")},P=async t=>{const n=t.target.files[0];if(n){b(!0);try{const i=M(W,`posts/${Date.now()}_${n.name}`);await O(i,n);const l=await _(i);a({...s,image:l})}catch(i){console.error("Error uploading image:",i),alert("Error uploading image. Make sure Firebase Storage is enabled.")}finally{b(!1)}}},k=async t=>{t.preventDefault(),x(!0);try{o?await H(y(d,"posts",o.id),{...s,updatedAt:S.now()}):await B(w(d,"posts"),{...s,createdAt:S.now()}),c(),j()}catch(n){console.error("Error saving post:",n),alert("Error saving post")}finally{x(!1)}},F=t=>{v(t),a({title:t.title||{he:"",en:""},excerpt:t.excerpt||{he:"",en:""},content:t.content||{he:"",en:""},image:t.image||""}),g(!0)},U=async t=>{if(window.confirm("Are you sure you want to delete this post?"))try{await $(y(d,"posts",t)),j()}catch(n){console.error("Error deleting post:",n),alert("Error deleting post")}},c=()=>{a({title:{he:"",en:""},excerpt:{he:"",en:""},content:{he:"",en:""},image:""}),v(null),g(!1)};return r.useEffect(()=>{localStorage.getItem("adminAuth")==="true"&&m(!0)},[]),h?e.jsxs("div",{className:"admin-page",children:[e.jsxs("div",{className:"admin-header",children:[e.jsx("h1",{children:"News Admin"}),e.jsxs("div",{className:"admin-actions",children:[e.jsx("button",{onClick:()=>{c(),g(!0)},className:"btn-primary",children:"+ New Post"}),e.jsx("button",{onClick:I,className:"btn-secondary",children:"Logout"})]})]}),E&&e.jsx("div",{className:"admin-modal",children:e.jsxs("div",{className:"admin-modal-content",children:[e.jsxs("div",{className:"admin-modal-header",children:[e.jsx("h2",{children:o?"Edit Post":"New Post"}),e.jsx("button",{onClick:c,className:"close-btn",children:"Ã—"})]}),e.jsxs("form",{onSubmit:k,className:"admin-form",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"Title (Hebrew)"}),e.jsx("input",{type:"text",value:s.title.he,onChange:t=>a({...s,title:{...s.title,he:t.target.value}}),required:!0,dir:"rtl"})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"Title (English)"}),e.jsx("input",{type:"text",value:s.title.en,onChange:t=>a({...s,title:{...s.title,en:t.target.value}})})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"Short Description (Hebrew)"}),e.jsx("textarea",{value:s.excerpt.he,onChange:t=>a({...s,excerpt:{...s.excerpt,he:t.target.value}}),required:!0,rows:"2",dir:"rtl"})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"Short Description (English)"}),e.jsx("textarea",{value:s.excerpt.en,onChange:t=>a({...s,excerpt:{...s.excerpt,en:t.target.value}}),rows:"2"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"Full Content (Hebrew)"}),e.jsx("textarea",{value:s.content.he,onChange:t=>a({...s,content:{...s.content,he:t.target.value}}),required:!0,rows:"6",dir:"rtl"})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"Full Content (English)"}),e.jsx("textarea",{value:s.content.en,onChange:t=>a({...s,content:{...s.content,en:t.target.value}}),rows:"6"})]})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"Image"}),e.jsxs("div",{className:"image-upload",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:P,id:"image-input"}),A&&e.jsx("span",{className:"uploading",children:"Uploading..."}),s.image&&e.jsxs("div",{className:"image-preview",children:[e.jsx("img",{src:s.image,alt:"Preview"}),e.jsx("button",{type:"button",onClick:()=>a({...s,image:""}),children:"Remove"})]})]}),e.jsx("p",{className:"hint",children:"Or paste image URL:"}),e.jsx("input",{type:"url",value:s.image,onChange:t=>a({...s,image:t.target.value}),placeholder:"https://example.com/image.jpg"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",onClick:c,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:u,children:u?"Saving...":o?"Update":"Create"})]})]})]})}),e.jsx("div",{className:"admin-posts",children:u?e.jsx("div",{className:"loading",children:"Loading..."}):f.length===0?e.jsx("div",{className:"no-posts",children:"No posts yet. Create your first post!"}):e.jsxs("table",{className:"posts-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Image"}),e.jsx("th",{children:"Title"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:f.map(t=>{var n,i,l,N;return e.jsxs("tr",{children:[e.jsx("td",{children:t.image?e.jsx("img",{src:t.image,alt:"",className:"table-thumb"}):e.jsx("div",{className:"no-image",children:"No image"})}),e.jsxs("td",{children:[e.jsx("strong",{children:((n=t.title)==null?void 0:n.he)||"Untitled"}),e.jsx("br",{}),e.jsx("small",{children:(i=t.title)==null?void 0:i.en})]}),e.jsx("td",{children:(N=(l=t.createdAt)==null?void 0:l.toDate)==null?void 0:N.call(l).toLocaleDateString("he-IL")}),e.jsxs("td",{children:[e.jsx("button",{onClick:()=>F(t),className:"btn-edit",children:"Edit"}),e.jsx("button",{onClick:()=>U(t.id),className:"btn-delete",children:"Delete"})]})]},t.id)})})]})})]}):e.jsx("div",{className:"admin-login",children:e.jsxs("div",{className:"admin-login-box",children:[e.jsx("h1",{children:"Admin Login"}),e.jsxs("form",{onSubmit:L,children:[e.jsx("input",{type:"password",value:p,onChange:t=>C(t.target.value),placeholder:"Enter password",autoFocus:!0}),e.jsx("button",{type:"submit",children:"Login"})]})]})})}export{Q as default};
